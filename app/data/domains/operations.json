{
  "domain": "operations",
  "description": "Configuration for operations domain",
  "schema_context": "The database contains information about users, their transactions, login events, and system-generated alerts. \n\n- **users**: Stores user profile information including `user_id`, `email`, `full_name`, `country` (e.g., 'AE', 'AU', 'CA', 'CH', 'DE'), `phone`, `date_of_birth`, KYC status (`kyc_status` like 'EXPIRED', 'PENDING', 'REJECTED', 'VERIFIED'), KYC verification/expiry timestamps, risk assessment (`risk_level` like 'HIGH', 'LOW', 'MEDIUM', `risk_score`), PEP status (`is_pep` as 0 or 1), account status (`account_status` like 'ACTIVE', 'FROZEN', 'SUSPENDED'), and timestamps for creation and updates.\n- **transactions**: Records all financial and operational transactions, with `txn_id`, associated `user_id`, `txn_type` (e.g., 'BONUS', 'DEPOSIT', 'FEE', 'TRADE', 'WITHDRAWAL'), `instrument` (e.g., 'AAPL', 'BTC/USD'), `amount`, `currency`, `amount_usd`, transaction `status` ('COMPLETED', 'FAILED', 'FLAGGED', 'PENDING'), `flag_reason` (e.g., 'Automated screening', 'Risk threshold exceeded'), `payment_method` ('CRYPTO', 'EWALLET', 'CARD', 'BANK_TRANSFER'), `external_ref`, `ip_address`, and creation/processing timestamps.\n- **login_events**: Logs user login attempts, including `event_id`, `user_id`, `email_attempted`, `ip_address`, `country` (e.g., 'AE', 'AU', 'CA', 'CH', 'DE'), `city`, `device_type` ('DESKTOP', 'MOBILE', 'TABLET'), `device_fingerprint`, `user_agent`, login `status` ('BLOCKED', 'FAILED', 'SUCCESS'), `failure_reason` (e.g., 'MFA_FAILED', 'IP_BLOCKED', 'WRONG_PASSWORD', 'ACCOUNT_LOCKED', 'SUSPICIOUS_ACTIVITY'), and timestamp.\n- **alert_rules**: Defines the rules for generating alerts, with `rule_id`, `rule_name` (e.g., 'Dormant Account Activity', 'Failed Auth Spike', 'High Risk Country', 'Large Transaction', 'New Geo Login'), `rule_type` ('THRESHOLD', 'VELOCITY', 'TIME', 'GEO', 'PATTERN'), `condition` (JSON string describing the rule logic), `severity` ('HIGH', 'MEDIUM', 'LOW', 'CRITICAL'), `is_active` (0 or 1), and creation timestamp.\n- **alerts**: Stores generated alerts, linked to `rule_name` and `rule_id`, `user_id`, `txn_id` (if applicable), `severity`, `status` ('DISMISSED', 'INVESTIGATING', 'OPEN', 'RESOLVED'), `details` (JSON string with more info), `assigned_to` (user/team handling the alert), `resolved_at` timestamp, `resolution_notes`, and creation timestamp.\n- **audit_logs**: Tracks system actions and queries performed by users, including `log_id`, `actor_id`, `action` (e.g., 'EXPORT', 'LOGIN', 'QUERY', 'UPDATE', 'VIEW'), `resource_type` ('REPORT', 'ALERT', 'DASHBOARD', 'TRANSACTION', 'USER'), `resource_id`, `query_text` (for relevant actions), `ip_address`, and creation timestamp.\n- **dashboards**: Contains metadata about user-created dashboards, including `dashboard_id`, `name`, `owner_id`, `widgets` (JSON defining dashboard components), `layout` (JSON for arrangement), deployment status (`is_deployed`, `deploy_url`), `refresh_interval`, and timestamps for creation and deployment.\n- **query_history**: Logs natural language queries and their corresponding generated SQL, `query_id`, `user_id`, `nl_query`, `generated_sql`, `result_count`, `is_favorite` flag, and creation timestamp.",
  "prompts": {
    "intent": "You are an AI assistant...\n\nDOMAIN SPECIFIC INSTRUCTION:\nAdd this instruction to the system prompt: Pay close attention to the specific values of columns like `kyc_status`, `txn_type`, `status`, `flag_reason`, `country`, `rule_name` and `account_status`. When generating SQL, prefer the actual values present in the database rather than generic placeholders.\n\nDOMAIN SPECIFIC INSTRUCTION:\nAdd this instruction to the system prompt: Consider abbreviations like 'KYC' (Know Your Customer), 'PEP' (Politically Exposed Person). Understand common alert rule types like 'THRESHOLD', 'VELOCITY', 'TIME', 'GEO', and 'PATTERN'. Pay attention to transaction statuses like 'FLAGGED', 'COMPLETED', 'PENDING', and 'FAILED'.\n\nDOMAIN SPECIFIC INSTRUCTION:\nYou are an expert SQL generator. Given a user's natural language query and a database schema, generate the most accurate SQL query. Focus on identifying entities like 'users', 'transactions', 'alerts', and attributes such as 'country', 'kyc_status', 'txn_type', 'severity', 'status'. Pay close attention to specific values like 'AE', 'AU', 'CA', 'CH', 'DE' for countries, 'EXPIRED', 'PENDING', 'REJECTED', 'VERIFIED' for KYC status, 'BONUS', 'DEPOSIT', 'FEE', 'TRADE', 'WITHDRAWAL' for transaction types, 'HIGH', 'MEDIUM', 'LOW', 'CRITICAL' for severity, and 'COMPLETED', 'FAILED', 'FLAGGED', 'PENDING', 'BLOCKED', 'OPEN', 'RESOLVED', 'DISMISSED' for status fields. Also, be mindful of the `is_pep` column which is a boolean indicator (0 for false, 1 for true).",
    "sql": null
  },
  "few_shots": [
    {
      "question": "How many users have a KYC status of 'VERIFIED'?",
      "sql": "SELECT count(*) FROM users WHERE kyc_status = 'VERIFIED'",
      "explanation": "This query counts the number of users in the `users` table where the `kyc_status` column is equal to 'VERIFIED'."
    },
    {
      "question": "What are the full names and email addresses of users from country 'DE'?",
      "sql": "SELECT full_name, email FROM users WHERE country = 'DE'",
      "explanation": "This query selects the `full_name` and `email` columns from the `users` table for users where the `country` column is 'DE'."
    },
    {
      "question": "Show the txn_id, user_id, and amount for all 'FLAGGED' transactions.",
      "sql": "SELECT txn_id, user_id, amount FROM transactions WHERE status = 'FLAGGED'",
      "explanation": "This query retrieves the `txn_id`, `user_id`, and `amount` from the `transactions` table where the `status` column is equal to 'FLAGGED'."
    },
    {
      "question": "List all alert rules with severity 'HIGH' and their rule names.",
      "sql": "SELECT rule_name FROM alert_rules WHERE severity = 'HIGH'",
      "explanation": "This query selects the `rule_name` from the `alert_rules` table where the `severity` column is 'HIGH'."
    },
    {
      "question": "What is the average risk score for users with account status 'ACTIVE'?",
      "sql": "SELECT avg(risk_score) FROM users WHERE account_status = 'ACTIVE'",
      "explanation": "This query calculates the average value of the `risk_score` column from the `users` table where the `account_status` is equal to 'ACTIVE'."
    },
    {
      "question": "What is the count of users with a KYC status of 'VERIFIED' and 'EXPIRED'?",
      "sql": "SELECT kyc_status, count(*) FROM users WHERE kyc_status IN ('VERIFIED', 'EXPIRED') GROUP BY kyc_status;",
      "explanation": "This query groups users by their 'kyc_status' ('VERIFIED' and 'EXPIRED') and counts the number of users in each group using the COUNT(*) function."
    },
    {
      "question": "Show the full names and risk levels of users whose risk level is 'HIGH' and are flagged as a PEP (Politically Exposed Person).",
      "sql": "SELECT full_name, risk_level FROM users WHERE risk_level = 'HIGH' AND is_pep = 1;",
      "explanation": "This query selects the 'full_name' and 'risk_level' columns from the 'users' table, filtering for users with a 'risk_level' of 'HIGH' and 'is_pep' equal to 1 (meaning they are a PEP)."
    },
    {
      "question": "List the transaction IDs and amount in USD for all 'FLAGGED' transactions with 'Risk threshold exceeded' as the flag reason.",
      "sql": "SELECT txn_id, amount_usd FROM transactions WHERE status = 'FLAGGED' AND flag_reason = 'Risk threshold exceeded';",
      "explanation": "This query retrieves the 'txn_id' and 'amount_usd' for transactions that have a 'status' of 'FLAGGED' and a 'flag_reason' of 'Risk threshold exceeded'."
    },
    {
      "question": "Retrieve the email addresses of users who have had 'FAILED' login attempts due to 'WRONG_PASSWORD'.",
      "sql": "SELECT email_attempted FROM login_events WHERE status = 'FAILED' AND failure_reason = 'WRONG_PASSWORD';",
      "explanation": "This query fetches the 'email_attempted' from the 'login_events' table where the 'status' is 'FAILED' and the 'failure_reason' is 'WRONG_PASSWORD', indicating a failed login due to an incorrect password."
    },
    {
      "question": "Show the rule names and associated severity of all alert rules that are active.",
      "sql": "SELECT rule_name, severity FROM alert_rules WHERE is_active = 1;",
      "explanation": "This query selects the 'rule_name' and 'severity' columns from the 'alert_rules' table, filtering for rows where 'is_active' is equal to 1, indicating that the rule is active."
    },
    {
      "question": "Show me all transactions from users in 'AU' with a 'HIGH' risk level.",
      "sql": "SELECT T1.txn_id, T1.user_id, T1.txn_type, T1.amount_usd FROM transactions AS T1 JOIN users AS T2 ON T1.user_id = T2.user_id WHERE T2.country = 'AU' AND T2.risk_level = 'HIGH'",
      "explanation": "This query joins the `transactions` and `users` tables to filter transactions based on the user's country ('AU') and their risk level ('HIGH'). It selects key transaction details."
    },
    {
      "question": "List all users whose KYC status is 'EXPIRED' and account is 'FROZEN'.",
      "sql": "SELECT user_id, full_name, email FROM users WHERE kyc_status = 'EXPIRED' AND account_status = 'FROZEN'",
      "explanation": "This query directly selects user identifiers and names from the `users` table, filtering for users who meet two specific criteria: an expired KYC status and a frozen account status."
    },
    {
      "question": "What is the total amount of 'DEPOSIT' transactions in USD that were 'COMPLETED'?",
      "sql": "SELECT SUM(amount_usd) FROM transactions WHERE txn_type = 'DEPOSIT' AND status = 'COMPLETED'",
      "explanation": "This query aggregates the `amount_usd` from the `transactions` table, specifically for transactions classified as 'DEPOSIT' and having a 'COMPLETED' status."
    },
    {
      "question": "Find the number of failed login attempts from IP addresses associated with 'SUSPICIOUS_ACTIVITY' or 'IP_BLOCKED' reasons.",
      "sql": "SELECT COUNT(event_id) FROM login_events WHERE status = 'FAILED' AND (failure_reason = 'SUSPICIOUS_ACTIVITY' OR failure_reason = 'IP_BLOCKED')",
      "explanation": "This query counts the number of login events from the `login_events` table where the login status was 'FAILED' and the `failure_reason` matches either 'SUSPICIOUS_ACTIVITY' or 'IP_BLOCKED'."
    },
    {
      "question": "Show me all 'CRITICAL' alerts that are currently 'OPEN'.",
      "sql": "SELECT alert_id, rule_name, user_id, created_at FROM alerts WHERE severity = 'CRITICAL' AND status = 'OPEN'",
      "explanation": "This query retrieves details of alerts from the `alerts` table, filtering for those with a 'CRITICAL' severity and an 'OPEN' status. It includes alert ID, rule name, user ID, and creation time."
    }
  ]
}